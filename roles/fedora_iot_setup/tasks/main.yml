---
- name: 'Configure OS'
  when: (containers_list is not defined)
  tags: ['os-setup']
  block:
    - name: 'Install packages'
      ansible.builtin.import_tasks: 'packages.yml'

    - name: 'Configure pam'
      ansible.builtin.import_tasks: 'pam.yml'

    - name: 'Configure firewalld'
      ansible.builtin.import_tasks: 'firewalld.yml'

    - name: 'Configure services'
      ansible.builtin.import_tasks: 'services.yml'

    - name: 'Configure automounts'
      ansible.builtin.import_tasks: 'automount.yml'
      when: (storage_server is defined)

    - name: 'Configure kernel'
      ansible.builtin.import_tasks: 'kernel.yml'

    - name: 'Configure email'
      ansible.builtin.import_tasks: 'email.yml'

    - name: 'Configure smart'
      ansible.builtin.import_tasks: 'smart.yml'
      when: (ansible_virtualization_role == "host")

    - name: 'Fix parsec'
      ansible.builtin.import_tasks: 'parsec.yml'
