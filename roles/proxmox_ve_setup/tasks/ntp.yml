---
- name: 'Disable default ntp pool'
  ansible.builtin.lineinfile:
    path: '/etc/chrony/chrony.conf'
    backrefs: true
    regexp: '^pool (.*) iburst$'
    line: '#pool \g<1> iburst'
  notify: 'Restart chrony service'

- name: 'Add local chrony source'
  ansible.builtin.copy:
    content: "server {{ ntp_server }} iburst\n"
    dest: '/etc/chrony/sources.d/gateway.sources'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify: 'Restart chrony service'
