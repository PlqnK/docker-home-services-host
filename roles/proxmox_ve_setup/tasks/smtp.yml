---
- name: 'Create postfix main.cf config file from template'
  ansible.builtin.template:
    src: 'main.cf.j2'
    dest: '/etc/postfix/main.cf'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify: 'Restart postfix service'

- name: 'Create postfix sasl_passwd file from template'
  ansible.builtin.template:
    src: 'sasl_passwd.j2'
    dest: '/etc/postfix/sasl_passwd'
    owner: 'root'
    group: 'root'
    mode: '0600'
  notify:
    - 'Postmap sasl_passwd'
    - 'Restart postfix service'

- name: 'Configure From header replacement'
  ansible.builtin.template:
    src: 'smtp_header_checks.j2'
    dest: '/etc/postfix/smtp_header_checks'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify:
    - 'Postmap smtp_header_checks'
    - 'Restart postfix service'

- name: 'Configure envelope from replacement'
  ansible.builtin.template:
    src: 'canonical.j2'
    dest: '/etc/postfix/canonical'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify:
    - 'Postmap canonical'
    - 'Restart postfix service'

- name: 'Postmap files and restart postfix if needed'
  ansible.builtin.meta: 'flush_handlers'
