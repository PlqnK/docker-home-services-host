---
- name: Get variables from main nextcloud role
  include_vars:
    file: roles/nextcloud/vars/main.yml

- name: Create database directory
  file:
    path: "{{ local_container_storage_path }}/nextcloud_mariadb/db"
    state: directory
    owner: 999
    group: 999
    mode: 0755

- name: Create docker internal network
  docker_network:
    name: internal
    state: present

- name: Create the Nextcloud MariaDB container
  docker_container:
    name: nextcloud_mariadb
    image: "mariadb:{{ mariadb_image_tag }}"
    restart_policy: unless-stopped
    networks:
      - name: internal
    volumes:
      - "{{ local_container_storage_path }}/nextcloud_mariadb/db:/var/lib/mysql"
    env:
      MYSQL_ROOT_PASSWORD: "{{ nextcloud_mysql_root_password }}"
      MYSQL_PASSWORD: "{{ nextcloud_mysql_password }}"
      MYSQL_DATABASE: "{{ nextcloud_mysql_database }}"
      MYSQL_USER: "{{ nextcloud_mysql_user }}"
    pull: yes
    state: started
