---
- name: 'Create mount points' # noqa risky-file-permissions
  ansible.builtin.file:
    path: '{{ autofs_base_path }}/{{ item }}'
    state: 'directory'
  loop: '{{ nfs_exports }}'

- name: 'Create autofs master file from template'
  ansible.builtin.template:
    src: 'master.autofs.j2'
    dest: '/etc/auto.master.d/{{ storage_server.name }}.autofs'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify: 'Restart autofs service'

- name: 'Create autofs template file from template'
  ansible.builtin.template:
    src: 'auto.template.j2'
    dest: '/etc/auto.{{ storage_server.name }}'
    owner: 'root'
    group: 'root'
    mode: '0644'
  notify: 'Restart autofs service'

- name: 'Enable and start the autofs service'
  ansible.builtin.systemd:
    name: 'autofs.service'
    enabled: true
    state: 'started'
