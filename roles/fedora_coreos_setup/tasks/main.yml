---
- name: 'Configure OS'
  when: (containers_list is not defined)
  tags: ['os-setup']
  block:
    - name: 'Install packages'
      ansible.builtin.import_tasks: 'packages.yml'

    - name: 'Configure filesystem'
      ansible.builtin.import_tasks: 'filesystem.yml'

    - name: 'Configure pam'
      ansible.builtin.import_tasks: 'pam.yml'

    - name: 'Configure bootupd'
      ansible.builtin.import_tasks: 'bootupd.yml'

    - name: 'Configure firewalld'
      ansible.builtin.import_tasks: 'firewalld.yml'

    - name: 'Configure fail2ban'
      ansible.builtin.import_tasks: 'fail2ban.yml'
      when: ("cloud_hosts" in group_names)

    - name: 'Configure wireguard'
      ansible.builtin.import_tasks: 'wireguard.yml'
      when: ("cloud_hosts" in group_names)

    - name: 'Configure services'
      ansible.builtin.import_tasks: 'services.yml'

    - name: 'Configure automounts'
      ansible.builtin.import_tasks: 'automount.yml'
      when: (storage_server is defined)

    - name: 'Configure smtp'
      ansible.builtin.import_tasks: 'smtp.yml'

    - name: 'Configure smart'
      ansible.builtin.import_tasks: 'smart.yml'
      when: (ansible_virtualization_role == "host")

    - name: 'Configure nut'
      ansible.builtin.import_tasks: 'nut.yml'
      when: (ansible_virtualization_role == "host")
