[Unit]
Description=Vdirsyncer
Wants=network-online.target
After=network-online.target
RequiresMountsFor=%t/containers

[Service]
Environment=PODMAN_SYSTEMD_UNIT=%n
Restart=no
TimeoutStopSec=70
ExecStart=/usr/bin/podman container run \
	--rm \
	--detach \
	--replace \
	--name vdirsyncer \
	--entrypoint /app/vdirsyncer.sh \
	--hostname {{ ansible_hostname }} \
	--network web-egress \
	--volume {{ containers_storage_path }}/config/vdirsyncer/vdirsyncer.sh:/app/vdirsyncer.sh:Z \
	--volume {{ containers_storage_path }}/config/vdirsyncer/config:/vdirsyncer/config:Z \
	--volume {{ containers_storage_path }}/runtime/vdirsyncer:/vdirsyncer/status:Z \
	--volume {{ storage_server_shares_mounts_path }}/backups/groupware/contacts:/contacts:slave \
	--volume {{ storage_server_shares_mounts_path }}/backups/groupware/calendars:/calendars:slave \
	--secret vdirsyncer_carddav_password \
	--secret vdirsyncer_caldav_password \
	--tz={{ timezone }} \
	--env TZ={{ timezone }} \
	--env HEALTHCHECKS_URL=healthchecks.{{ domain_name }}/ping \
	--env HEALTHCHECKS_UUID={{ vdirsyncer.healthchecks_uuid }} {{ containers_images.vdirsyncer }}:{{ containers_images_tags.vdirsyncer }}
Type=forking

[Install]
WantedBy=default.target
